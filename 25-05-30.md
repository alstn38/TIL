### Swift 5.1 (SwiftUI)

- Property Wrapper
- Opaque Type

### Swift 5.5 (Concurrency)

- Async/Await
- Actor
- Sendable

### Swift 5.9

- Copyable
- Ownership

### Swift 6

- ì»´íŒŒì¼ íƒ€ì„ì— ë™ì‹œì„± ì´ìŠˆ í•´ê²°
- @preconcurrency
- nonisolated

```swift
class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        usePoint()
    }

    // Main Thread
    func usePoint() {
        let point = Point()
        
        // Capture of 'point' with non-sendable type
        // 'Point' in a '@Sendable' closure
        DispatchQueue.global().async {
            point.plus()
        }
        
        point.minus()
    }
}
```

<aside>
ğŸ’¡

Capture of 'point' with non-sendable type 'Point' in a '@Sendable' closure

</aside>

í´ë¡œì € ìº¡ì²˜ë¦¬ìŠ¤íŠ¸ë¡œ íŠ¹ì • ê°’ì„ ìº¡ì³í–ˆì§€ë§Œ í•´ë‹¹ ê°’ì´ Sendableí•˜ì§€ ì•Šë‹¤.

### Sendable Protocol - Swift 5.5

- Actor
    - í•œ ìŠ¤ë ˆë“œì—ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ëœë‹¤. ì¦‰, ì„ê³„ ì˜ì—­ì„ ìƒì„±í•œë‹¤.
    - actor: Sendable

- Sendable
    - Data Raceê°€ ë°œìƒí•˜ì§€ ì•ŠìŒì„ ë³´ì¥í•˜ëŠ” í”„ë¡œí† ì½œì´ë‹¤.
    - íƒ€ì…ì´ ì—¬ëŸ¬ ì“°ë ˆë“œ ê°„ì— ì•ˆì „í•˜ê²Œ ì½ê³ /ì“¸ ìˆ˜ ìˆë„ë¡.
    - ì‚¬ìš©í•œë‹¤ê³  í•´ì„œ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ ë³€ê²½ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì—°ì‡„ì ì¸ ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
    - Actor. Enum. Struct. Immutable. @MainActor Class
    - classì— ë³€ìˆ˜, ì €ì¥ í”„ë¡œí¼í‹°ê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤. ì¦‰ ë°ì´í„°ê°€ ë³€ê²½ë˜ëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë©´ ë™ì‹œì„± ì´ìŠˆê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•œë‹¤.

UIViewControllerëŠ” @MainActorê°€ ë¶™ì–´ìˆë‹¤.

- UIëŠ” ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•œë‹¤.
- Swift Concurrency ì½”ë“œì— í•œí•´ì„œ mainìŠ¤ë ˆë“œë¡œ ìë™ìœ¼ë¡œ ëŒë ¤ì¤€ë‹¤. (Swift Concurrency, asynchronous, await, Task) == ë©”ì¸ìŠ¤ë ˆë“œ

- Sendableì„ ì¤€ìˆ˜í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì€ == ë™ì‹œì„± í™˜ê²½ì—ì„œ ì•ˆì „í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

ë™ì‹œì„± ì´ìŠˆë¥¼ í•´ê²°í•´ë³´ê¸°. â‡’ actor-isolated

1. Sendableì„ í”„ë¡œí† ì½œ ì±„íƒí•´ë³´ì.
    - final classê°€ ì•„ë‹ˆë©´ Sendableì„ ë§Œì¡±ì‹œí‚¬ìˆ˜ëŠ” ì—†ë‹¤.
    - ì»´íŒŒì¼ëŸ¬ëŠ” ì•ˆì „í•˜ì§€ ì•Šë‹¤ê³  ìƒê°í•˜ì—¬ ì»´íŒŒì¼ ê²½ê³ ë¥¼ ë„ìš°ê²Œ ëœë‹¤.
    - ì™œëƒí•˜ë©´ ì„œë¸Œí´ë˜ì‹±ì—ì„œ Sendable ìš”êµ¬ì‚¬í•­ì„ ìœ„ë°˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
2. @MainActorë¥¼ ì‘ì„±í•´ë³´ì.

```swift
@MainActor
class Point {
    var total = 0
    
    func plus() {
        total += 1
        print(#function, total)
    }
    
    func minus() {
        total -= 1
        print(#function, total)
    }
}

class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        usePoint()
    }

    func usePoint() {
        let point = Point()
        
//        Call to main actor-isolated instance method 'plus()'
// in a synchronous nonisolated context
        DispatchQueue.global().async {
            point.plus()
        }
        
        point.minus()
    }
}

```

Call to main actor-isolated instance method 'plus()' in a synchronous nonisolated context

â†’ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ í˜¸ì¶œ ê°€ëŠ¥í•œ í´ë˜ìŠ¤ë¥¼, ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë‹¤. 

â†’ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì•„ë‹Œ ê²ƒì€ Isolatedê°€ ì—†ë‹¤ëŠ” ê²ƒ.

â†’ ë¹„ë©”ì¸ ì•¡í„° ì»¨í…ìŠ¤íŠ¸, nonIsolated

### @unchecked Sendable

- ì»´íŒŒì¼ëŸ¬ê°€ Swift6 ë™ì‹œì„± ì´ìŠˆë¥¼ ê°ì§€í•œë‹¤. í•˜ì§€ë§Œ í•´ë‹¹ í‚¤ì›Œë“œê°€ ë¶™ëŠ”ë‹¤ë©´ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.
- ì¦‰, ì»´íŒŒì¼ëŸ¬ê°€ ê²€ì‚¬ë¥¼ ë¹„í™œì„±í™”í•˜ê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì§ì ‘ ìŠ¤ë ˆë“œê°€ ì•ˆì „í•˜ê²Œ ì„¤ì •í•˜ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.

```swift
struct Point: Sendable {
    var total = 0
    
    mutating func plus() {
        total += 1
        print(#function, total)
    }
    
    mutating func minus() {
        total -= 1
        print(#function, total)
    }
}

class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        usePoint()
    }

    // Main Thread
    func usePoint() {
        var point = Point()
        
        // Mutation of captured var 'point' in concurrently-executing code
        DispatchQueue.global().async {
            point.plus()
        }
        
        point.minus()
    }
}

```

Mutation of captured var 'point' in concurrently-executing code

â†’ ë™ì‹œì— ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” í™˜ê²½ì¼ ê²ƒ ê°™ë‹¤ëŠ” ë…¸ë€ ê²½ê³ ..

### actor

```swift
actor Point {
    var total = 0
    
    func plus() {
        total += 1
        print(#function, total)
    }
    
    func minus() {
        total -= 1
        print(#function, total)
    }
}
```

- ë™ì‹œì— ì ‘ê·¼í•´ì„œ ì½ê±°ë‚˜ ì“°ì§€ ì•Šë„ë¡ ì´ë¯¸ ì„¤ì • > ìƒì† X
- ì•”ì‹œì ìœ¼ë¡œ ê²©ë¦¬ë˜ì–´ ìˆë‹¤. isolated ìƒíƒœì´ë‹¤.
    - ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ë•Œ awaitì„ í†µí•´ì„œ í˜¸ì¶œí•´ì•¼í•œë‹¤. ì–µì§€ë¡œ ì§ë ¬ ìƒíƒœë¡œ ë™ì‘í•˜ê²Œë” ì„¤ì •í•œë‹¤.
- actorë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ê²°êµ­ async/awaitë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

```swift
override func viewDidLoad() {
    super.viewDidLoad()
    
    let a = Point()
    Task {
        await a.plus()
        a.total += 1 // ì™¸ë¶€ì—ì„œ ë‚´ë¶€ ë³€ìˆ˜ ìˆ˜ì • ë¶ˆê°€ëŠ¥ !!
    }
}
```

Actor: ê²©ë¦¬ ìƒíƒœë¥¼ ë§Œë“ ë‹¤.

- actor ë‚´ì— ë©”ì„œë“œ, í”„ë¡œí¼í‹°ëŠ” actor-isolated ìƒíƒœì´ë‹¤.
- ì™¸ë¶€ì—ì„œ actor ë‚´ì˜ ë©”ì„œë“œ, í”„ë¡œí¼í‹°, async ë¹„ë™ê¸°ë¡œ ëŠ˜ í˜¸ì¶œì„ í•´ì•¼í•œë‹¤.
    - awaitì„ í†µí•´ ìˆœì°¨ì ì¸ ì‹¤í–‰ì„ ë³´ì¥ì„ í•œë‹¤. ì¦‰, ë™ì‹œ ì ‘ê·¼ X
- ì½ëŠ” ìš©ë„ë¡œ ì„ ì–¸ëœ ìƒìˆ˜ì— ëŒ€í•´ì„œë„ awaitì„ ì¨ì•¼í•œë‹¤.
    - ë¶ˆí•„ìš”í•œ ì§ë ¬í™”ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤..
    - ê·¸ëŸ´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ nonisolated í‚¤ì›Œë“œì´ë‹¤.
    
    ```swift
    /// ì•¡í„°ì˜ ì§ë ¬í™”ë¥¼ ìš°íšŒí•´ì„œ, ì¼ë°˜ì ì¸ í´ë˜ìŠ¤/êµ¬ì¡°ì²´ì²˜ëŸ¼ ë™ì‘ì´ ë˜ê²Œë”í•œë‹¤.
    /// ì™œëƒí•˜ë©´ ê²©ë¦¬í•  í•„ìš”ê°€ ì—†ëŠ” ë©”ì„œë“œ, í”„ë¡œí¼í‹°ì´ê¸° ë•Œë¬¸ì´ë‹¤.
    nonisolated func introduce() -> String {
        return "ì €ëŠ” \(nickname)ì…ë‹ˆë‹¤."
    }
    ```
    

í•˜ì§€ë§Œ, ì´ì œ ë¬´ì‹œí•˜ë©´ ì•ˆë˜ëŠ” ê²ƒì— ì§„ì§œ ë¬´ì‹œí•˜ê³  ì‹¶ì€ ê²½ìš°ì— nonisolated(unsafe)ë¥¼ ì‚¬ìš©í•œë‹¤.

5.5 ì˜ˆì „ì˜ ë ˆê±°ì‹œ ì½”ë“œë“¤, ì¦‰ ë™ì‹œì„± ëª¨ë¸(actor) ë“±ì¥ ì „ì— êµ¬ì„±ëœ í”„ë ˆì„ì›Œí¬ë“¤ì˜ ì½”ë“œë“¤ì„ í™œìš©í•  ë•ŒëŠ” actor, isolatedë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•œë‹¤.

ê·¸ë•ŒëŠ” ì´ì œ @preconcurrencyë¥¼ ì‚¬ìš©í•œë‹¤.

```swift
@MainActor
class LocationService: NSObject, @preconcurrency CLLocationManagerDelegate {
    nonisolated func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
        <#code#>
    }
}

// í˜¹ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ì•„ë˜ì™€ ê°™ì´ ë¶ˆëŸ¬ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
@preconcurrency import LegacyLibrary
```
